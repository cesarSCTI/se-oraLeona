{% comment %}
  Section: Two Column Builder (Main Image + Blocks)
  File: sections/two-col-builder.liquid
{% endcomment %}

<section
  class="tc-builder"
  style="
    --tc-bg: {{ section.settings.bg_color }};
    --tc-text: {{ section.settings.text_color }};
    --tc-border: {{ section.settings.border_color }};
    --tc-radius: {{ section.settings.radius }}px;
    --tc-gap: {{ section.settings.gap }}px;
    --tc-pad-y: {{ section.settings.pad_y }}px;
  "
>
  <div class="tc-builder__container page-width">
    <div class="tc-builder__grid tc-builder__grid--{{ section.settings.layout }}">
      {%- comment -%} LEFT: Main image {%- endcomment -%}
      <div class="tc-builder__left">
        <div class="tc-card tc-card--main">
          {% if section.settings.main_image != blank %}
            {% assign main_img = section.settings.main_image %}
            {{
              main_img
              | image_url: height: 800
              | image_tag:
                loading: section.settings.image_loading,
                class: "tc-main-img",
                widths: "375, 550, 750, 900, 1100, 1400",
                sizes: "(min-width: 990px) 50vw, 100vw",
                alt: section.settings.main_image_alt | escape
            }}
          {% else %}
            <div class="tc-placeholder">
              Agrega una imagen principal en la configuración de la sección.
            </div>
          {% endif %}
        </div>
      </div>

      {%- comment -%} RIGHT: Blocks {%- endcomment -%}
      <div class="tc-builder__right">
        <div class="tc-stack" style="--tc-stack-gap: {{ section.settings.stack_gap }}px;">
          {% for block in section.blocks %}
            <div class="tc-card tc-card--block" {{ block.shopify_attributes }}>
              {% case block.type %}

                {% when 'image' %}
                  {% if block.settings.image != blank %}
                    {% assign bimg = block.settings.image %}
                    <div class="tc-block tc-block--image">
                      {{
                        bimg
                        | image_url: width: 400
                        | image_tag:
                          loading: section.settings.image_loading,
                          class: "tc-block-img",
                          alt: block.settings.alt | escape
                      }}
                    </div>
                  {% else %}
                    <div class="tc-placeholder">Bloque de imagen sin contenido.</div>
                  {% endif %}

                {% when 'text' %}
                  <div class="tc-block tc-block--text tc-align-{{ block.settings.align }}">
                    {% if block.settings.kicker != blank %}
                      <p class="tc-kicker">{{ block.settings.kicker }}</p>
                    {% endif %}

                    {% if block.settings.heading != blank %}
                      <h2 class="tc-heading" style="font-size: {{ block.settings.heading_size }}px;">
                        {{ block.settings.heading }}
                      </h2>
                    {% endif %}

                    {% if block.settings.body != blank %}
                      <div class="tc-body rte">
                        {{ block.settings.body }}
                      </div>
                    {% endif %}
                  </div>

                {% when 'button' %}
                  <div class="tc-block tc-block--button tc-align-{{ block.settings.align }}">
                    {% assign url = block.settings.url %}
                    {% assign label = block.settings.label %}
                    {% if label != blank %}
                      <a
                        class="tc-btn tc-btn--{{ block.settings.style }}"
                        {% if url != blank %}href="{{ url }}"{% else %}role="button" aria-disabled="true"{% endif %}
                        {% if block.settings.new_tab and url != blank %}target="_blank" rel="noopener noreferrer"{% endif %}
                      >
                        {{ label }}
                      </a>
                    {% else %}
                      <div class="tc-placeholder">Configura el texto del botón.</div>
                    {% endif %}
                  </div>

                {% when 'html' %}
                  <div class="tc-block tc-block--html">
                    {{ block.settings.html }}
                  </div>

              {% endcase %}
            </div>
          {% endfor %}

          {% if section.blocks.size == 0 %}
            <div class="tc-card tc-card--block">
              <div class="tc-placeholder">
                Agrega bloques (imagen / texto / botón / HTML) desde el editor.
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .tc-builder{
    background: var(--tc-bg);
    color: var(--tc-text);
    padding: var(--tc-pad-y) 0;
  }

  .tc-builder__container{
    width: 100%;
  }

  .tc-builder__grid{
    display: grid;
    gap: var(--tc-gap);
    align-items: stretch;
  }

  /* Layout options */
  .tc-builder__grid--image_left{
    grid-template-columns: 1fr 1fr;
    align-items:center;
  }
  .tc-builder__grid--image_right{
    grid-template-columns: 1fr 1fr;
  }
  .tc-builder__grid--image_right .tc-builder__left{ order: 2; }
  .tc-builder__grid--image_right .tc-builder__right{ order: 1; }

  .tc-card{
    border: 3px solid var(--tc-border);
    border-radius: var(--tc-radius);
    background: rgba(255,255,255,.0);
    overflow: hidden;
  }

  .tc-card--main{
    height: 100%;
  }

  .tc-main-img{
    width: 100%;
    display: block;
    object-fit: contain; /* cambia a cover si quieres recorte */
  }

  .tc-stack{
    display: grid;
    gap: var(--tc-stack-gap);
    height: 100%;
  }

  .tc-card--block{
    padding: 16px;
    display: block;
  }

  .tc-block-img{
    width: 100%;
    height: auto;
    display: block;
    object-fit: contain;
  }

  .tc-placeholder{
    padding: 18px;
    font-size: 14px;
    opacity: .75;
  }

  .tc-kicker{
    margin: 0 0 8px 0;
    font-size: 12px;
    letter-spacing: .12em;
    text-transform: uppercase;
    opacity: .8;
  }

  .tc-heading{
    margin: 0 0 10px 0;
    line-height: 1.05;
  }

  .tc-body{
    font-size: 14px;
    line-height: 1.5;
  }

  .tc-align-left{ text-align: left; }
  .tc-align-center{ text-align: center; }
  .tc-align-right{ text-align: right; }

  .tc-btn{
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 12px 18px;
    border-radius: calc(var(--tc-radius) - 2px);
    text-decoration: none;
    font-weight: 700;
    letter-spacing: .06em;
    text-transform: uppercase;
    transition: transform .12s ease, opacity .12s ease;
    user-select: none;
    min-width: 160px;
  }
  .tc-btn[aria-disabled="true"]{
    opacity: .5;
    pointer-events: none;
  }
  .tc-btn:hover{ transform: translateY(-1px); }

  .tc-btn--solid{
    background: var(--tc-border);
    color: #000;
    border: 2px solid var(--tc-border);
  }
  .tc-btn--outline{
    background: transparent;
    color: var(--tc-text);
    border: 2px solid var(--tc-border);
  }
  .tc-btn--ghost{
    background: rgba(0,0,0,.06);
    color: var(--tc-text);
    border: 2px solid transparent;
  }

  /* Responsive */
  @media (max-width: 989px){
    .tc-builder__grid{
      grid-template-columns: 1fr !important;
    }
    .tc-builder__grid--image_right .tc-builder__left,
    .tc-builder__grid--image_right .tc-builder__right{
      order: initial;
    }
    .tc-card--block{
      padding: 14px;
    }
  }
</style>

{% schema %}
{
  "name": "Two Column Builder",
  "settings": [
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "default": "image_left",
      "options": [
        { "value": "image_left", "label": "Imagen a la izquierda" },
        { "value": "image_right", "label": "Imagen a la derecha" }
      ]
    },
    {
      "type": "image_picker",
      "id": "main_image",
      "label": "Imagen principal"
    },
    {
      "type": "text",
      "id": "main_image_alt",
      "label": "Alt de la imagen principal",
      "default": "Imagen principal"
    },
    {
      "type": "select",
      "id": "image_loading",
      "label": "Loading de imágenes",
      "default": "lazy",
      "options": [
        { "value": "lazy", "label": "lazy" },
        { "value": "eager", "label": "eager" }
      ]
    },

    { "type": "header", "content": "Estilo" },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Fondo",
      "default": "#F5F2E6"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Texto",
      "default": "#111111"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Color del borde",
      "default": "#19F000"
    },
    {
      "type": "range",
      "id": "radius",
      "label": "Radio (px)",
      "min": 0,
      "max": 32,
      "step": 1,
      "default": 0
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Separación entre columnas (px)",
      "min": 8,
      "max": 48,
      "step": 1,
      "default": 18
    },
    {
      "type": "range",
      "id": "stack_gap",
      "label": "Separación entre bloques (px)",
      "min": 8,
      "max": 40,
      "step": 1,
      "default": 16
    },
    {
      "type": "range",
      "id": "pad_y",
      "label": "Padding vertical sección (px)",
      "min": 0,
      "max": 120,
      "step": 4,
      "default": 32
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Bloque: Imagen",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Imagen" },
        { "type": "text", "id": "alt", "label": "Alt", "default": "Imagen" }
      ]
    },
    {
      "type": "text",
      "name": "Bloque: Texto",
      "settings": [
        {
          "type": "select",
          "id": "align",
          "label": "Alineación",
          "default": "left",
          "options": [
            { "value": "left", "label": "Izquierda" },
            { "value": "center", "label": "Centro" },
            { "value": "right", "label": "Derecha" }
          ]
        },
        { "type": "text", "id": "kicker", "label": "Kicker (opcional)", "default": "FOR" },
        { "type": "text", "id": "heading", "label": "Título", "default": "Espíritus Salvajes" },
        {
          "type": "range",
          "id": "heading_size",
          "label": "Tamaño título (px)",
          "min": 18,
          "max": 64,
          "step": 1,
          "default": 44
        },
        { "type": "richtext", "id": "body", "label": "Texto", "default": "<p>Tequila blanco, orgánico, 100% agave.</p>" }
      ]
    },
    {
      "type": "button",
      "name": "Bloque: Botón",
      "settings": [
        {
          "type": "select",
          "id": "align",
          "label": "Alineación",
          "default": "left",
          "options": [
            { "value": "left", "label": "Izquierda" },
            { "value": "center", "label": "Centro" },
            { "value": "right", "label": "Derecha" }
          ]
        },
        { "type": "text", "id": "label", "label": "Texto del botón", "default": "Shop now" },
        { "type": "url", "id": "url", "label": "Link" },
        {
          "type": "select",
          "id": "style",
          "label": "Estilo",
          "default": "outline",
          "options": [
            { "value": "solid", "label": "Solid" },
            { "value": "outline", "label": "Outline" },
            { "value": "ghost", "label": "Ghost" }
          ]
        },
        { "type": "checkbox", "id": "new_tab", "label": "Abrir en nueva pestaña", "default": false }
      ]
    },
    {
      "type": "html",
      "name": "Bloque: HTML",
      "settings": [
        {
          "type": "textarea",
          "id": "html",
          "label": "HTML",
          "default": "<div style='font-weight:700; letter-spacing:.08em; text-transform:uppercase;'>Amatitán, Jal. — Made in Mexico</div>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Two Column Builder",
      "blocks": [
        { "type": "text" },
        { "type": "html" },
        { "type": "button" }
      ]
    }
  ]
}
{% endschema %}
